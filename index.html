<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rialo Explorer</title>
  <style>
    body { margin:0; overflow:hidden; background:#111; }
    #scoreboard {
      position:fixed; top:10px; left:10px;
      color:white; font-size:18px; font-family:Arial,sans-serif;
      background:rgba(0,0,0,0.5); padding:8px 12px; border-radius:6px;
      z-index:10;
    }
    #message {
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      color:yellow; font-size:16px;
      background:rgba(0,0,0,0.6); padding:6px 12px; border-radius:6px;
      display:none; z-index:10;
    }
    #controls { position:fixed; bottom:30px; left:20px; display:none; gap:15px; z-index:20; }
    #actions { position:fixed; bottom:30px; right:20px; display:none; flex-direction:column; gap:15px; z-index:20; }
    .btn {
      width:60px; height:60px; border-radius:50%;
      background:rgba(255,255,255,0.2); border:2px solid white;
      color:white; font-size:28px; display:flex; justify-content:center; align-items:center;
      user-select:none; touch-action:none; cursor:pointer;
    }
    .btn:active { background:rgba(255,255,255,0.5); }
    #startScreen {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.9); display:flex; flex-direction:column; justify-content:center; align-items:center;
      z-index:100; color:white; font-family:Arial,sans-serif;
    }
    #startButton {
      margin-top:20px; padding:12px 24px; font-size:20px; border:2px solid white;
      background:transparent; color:white; border-radius:8px; cursor:pointer;
    }
    #startButton:hover { background:rgba(255,255,255,0.2); }
  </style>
</head>
<body>
  <div id="scoreboard">Rialo Points: 0</div>
  <div id="message"></div>

  <div id="controls">
    <div class="btn" data-key="KeyA">⬅️</div>
    <div class="btn" data-key="KeyW">⬆️</div>
    <div class="btn" data-key="KeyS">⬇️</div>
    <div class="btn" data-key="KeyD">➡️</div>
  </div>

  <div id="actions">
    <div class="btn" id="btnE">E</div>
  </div>

  <div id="startScreen">
    <h1>Rialo Explorer</h1>
    <p>Collect resources (E) and earn Rialo Points.</p>
    <button id="startButton">Start Game</button>
  </div>

  <script type="module">
    import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js";
    import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.161.0/examples/jsm/controls/OrbitControls.js";

    let scene, camera, renderer, controls;
    let player, resources=[];
    let score=0;
    const scoreboard=document.getElementById("scoreboard");
    const message=document.getElementById("message");
    const keys={};

    function createPlayer(){
      const g=new THREE.Group();
      const body=new THREE.Mesh(new THREE.CylinderGeometry(0.5,0.5,1.6,16),new THREE.MeshPhongMaterial({color:0x8b5e3c}));
      g.add(body);
      g.position.set(0,0.8,0);
      return g;
    }

    function initGame(){
      scene=new THREE.Scene(); scene.background=new THREE.Color(0x87ceeb);
      camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
      camera.position.set(0,5,10);

      renderer=new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(window.innerWidth,window.innerHeight);
      document.body.appendChild(renderer.domElement);

      controls=new OrbitControls(camera,renderer.domElement);
      controls.target.set(0,1,0); controls.enableDamping=true;

      const light=new THREE.DirectionalLight(0xffffff,1);
      light.position.set(10,20,10);
      scene.add(light,new THREE.AmbientLight(0x404040));

      const ground=new THREE.Mesh(new THREE.PlaneGeometry(200,200),new THREE.MeshPhongMaterial({color:0x228833}));
      ground.rotation.x=-Math.PI/2; scene.add(ground);

      player=createPlayer(); scene.add(player);

      for(let i=0;i<10;i++) spawnTree();
      for(let i=0;i<6;i++) spawnRock();
      for(let i=0;i<4;i) spawnGold();

      window.addEventListener("resize",onWindowResize);
      animate();
    }

    function spawnTree(){
      const trunk=new THREE.Mesh(new THREE.CylinderGeometry(0.3,0.5,2),new THREE.MeshPhongMaterial({color:0x8b4513}));
      const leaves=new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8),new THREE.MeshPhongMaterial({color:0x228b22}));
      const tree=new THREE.Group();
      trunk.position.y=1; leaves.position.y=2.5;
      tree.add(trunk,leaves);
      tree.position.set((Math.random()-0.5)*100,0,(Math.random()-0.5)*100);
      scene.add(tree); resources.push({mesh:tree,type:"tree",points:5});
    }
    function spawnRock(){
      const rock=new THREE.Mesh(new THREE.DodecahedronGeometry(1),new THREE.MeshPhongMaterial({color:0x808080}));
      rock.position.set((Math.random()-0.5)*100,1,(Math.random()-0.5)*100);
      scene.add(rock); resources.push({mesh:rock,type:"rock",points:8});
    }
    function spawnGold(){
      const gold=new THREE.Mesh(new THREE.SphereGeometry(0.8,12,12),new THREE.MeshPhongMaterial({color:0xffd700}));
      gold.position.set((Math.random()-0.5)*100,1,(Math.random()-0.5)*100);
      scene.add(gold); resources.push({mesh:gold,type:"gold",points:15});
    }

    function flashMessage(txt){
      message.innerText=txt; message.style.display="block";
      clearTimeout(message._hideTimeout);
      message._hideTimeout=setTimeout(()=>message.style.display="none",1200);
    }

    function gatherResource(){
      let closest=null,dist=3;
      for(let r of resources){
        const d=player.position.distanceTo(r.mesh.position);
        if(d<dist){dist=d;closest=r;}
      }
      if(closest){
        scene.remove(closest.mesh);
        resources.splice(resources.indexOf(closest),1);
        score+=closest.points;
        scoreboard.innerText="Rialo Points: "+score;
        flashMessage("Collected "+closest.type+"!");
      }else flashMessage("No resource nearby");
    }

    window.addEventListener("keydown",e=>{keys[e.code]=true;if(e.code==="KeyE") gatherResource();});
    window.addEventListener("keyup",e=>{keys[e.code]=false;});
    document.querySelectorAll("#controls .btn").forEach(btn=>{
      const key=btn.dataset.key;
      btn.addEventListener("pointerdown",ev=>{ev.preventDefault();keys[key]=true;});
      btn.addEventListener("pointerup",()=>keys[key]=false);
      btn.addEventListener("pointerleave",()=>keys[key]=false);
    });
    document.getElementById("btnE").addEventListener("pointerdown",ev=>{ev.preventDefault();gatherResource();});

    function movePlayer(delta){
      const speed=5;
      if(keys["KeyW"]) player.position.z-=speed*delta;
      if(keys["KeyS"]) player.position.z+=speed*delta;
      if(keys["KeyA"]) player.position.x-=speed*delta;
      if(keys["KeyD"]) player.position.x+=speed*delta;
      camera.position.set(player.position.x,player.position.y+4,player.position.z+8);
      controls.target.copy(player.position);
    }

    const clock=new THREE.Clock();
    function animate(){
      requestAnimationFrame(animate);
      const delta=clock.getDelta();
      movePlayer(delta);
      controls.update();
      renderer.render(scene,camera);
    }

    function onWindowResize(){
      camera.aspect=window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth,window.innerHeight);
    }

    document.getElementById("startButton").addEventListener("click",()=>{
      document.getElementById("startScreen").style.display="none";
      initGame();
      if(/Mobi|Android/i.test(navigator.userAgent)){
        document.getElementById("controls").style.display="flex";
        document.getElementById("actions").style.display="flex";
      }
    });
  </script>
</body>
</html>
