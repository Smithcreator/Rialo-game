<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Rialo Explorer</title>
  <style>
    body { margin:0; overflow:hidden; background:#111; font-family:Arial,sans-serif; color:#fff; }
    #hud {
      position:fixed; left:10px; top:10px; z-index:50;
      background:rgba(0,0,0,0.5); padding:8px 12px; border-radius:6px;
    }
    #message {
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      color:yellow; font-size:16px; background:rgba(0,0,0,0.6);
      padding:6px 12px; border-radius:6px; display:none; z-index:60;
    }
    #startScreen {
      position:fixed; inset:0; display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,0.9); z-index:200; color:white;
    }
    #startButton {
      margin-top:20px; padding:10px 20px; font-size:18px;
      border:2px solid white; border-radius:8px; background:transparent; color:white;
      cursor:pointer;
    }
    #minimap { position:fixed; right:10px; top:10px; border:2px solid white; z-index:50; background:black; }
  </style>
</head>
<body>
  <div id="hud">
    Rialo Points: <span id="score">0</span><br/>
    Controls: WASD move, E gather
  </div>
  <canvas id="minimap" width="150" height="150"></canvas>
  <div id="message"></div>

  <div id="startScreen">
    <h1>Rialo Explorer</h1>
    <p>Collect resources (E) and earn Rialo Points!</p>
    <button id="startButton">Start Game</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.136.0/build/three.min.js"></script>
  <script>
    let scene, camera, renderer;
    let player, playerGroup;
    let resources = [];
    let score = 0;
    const keys = {};
    const scoreEl = document.getElementById("score");
    const messageEl = document.getElementById("message");
    const minimap = document.getElementById("minimap");
    const ctx = minimap.getContext("2d");
    const clock = new THREE.Clock();

    function flashMessage(txt) {
      messageEl.innerText = txt;
      messageEl.style.display = "block";
      setTimeout(() => messageEl.style.display = "none", 1200);
    }

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x222222);

      renderer = new THREE.WebGLRenderer({ antialias:true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);

      // ground
      const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(200,200),
        new THREE.MeshLambertMaterial({ color:0x226622 })
      );
      ground.rotation.x = -Math.PI/2;
      scene.add(ground);

      // lights
      const dir = new THREE.DirectionalLight(0xffffff, 1);
      dir.position.set(10,20,10);
      scene.add(dir);
      scene.add(new THREE.AmbientLight(0x404040));

      // player group + sprite
      playerGroup = new THREE.Group();
      scene.add(playerGroup);

      const tex = new THREE.TextureLoader().load("sloth.png");
      const aspect = 0.7;
      const geo = new THREE.PlaneGeometry(1.5*aspect,1.5);
      const mat = new THREE.MeshBasicMaterial({ map:tex, transparent:true });
      player = new THREE.Mesh(geo, mat);
      player.position.y = 0.75;
      playerGroup.add(player);

      // camera third person behind player
      camera.position.set(0,2.5,-4);
      playerGroup.add(camera);

      // spawn Rialo banner
      const logoTex = new THREE.TextureLoader().load("rialo_logo.png");
      const logo = new THREE.Mesh(
        new THREE.PlaneGeometry(12,6),
        new THREE.MeshBasicMaterial({ map:logoTex, transparent:true })
      );
      logo.position.set(0,8,-15);
      scene.add(logo);

      // spawn resources
      for (let i=0;i<25;i++) spawnResource();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }

    function spawnResource() {
      const types = [0x8b4513,0xaaaaaa,0xffd700];
      const color = types[Math.floor(Math.random()*types.length)];
      const mesh = new THREE.Mesh(
        new THREE.BoxGeometry(1,1,1),
        new THREE.MeshLambertMaterial({ color })
      );
      mesh.position.set((Math.random()-0.5)*80,0.5,(Math.random()-0.5)*80);
      scene.add(mesh);
      resources.push(mesh);
    }

    function gather() {
      let closest=null, dist=2;
      const pos = playerGroup.position;
      for (let r of resources) {
        const d = pos.distanceTo(r.position);
        if (d<dist) { dist=d; closest=r; }
      }
      if (closest) {
        scene.remove(closest);
        resources = resources.filter(x=>x!==closest);
        score += 5;
        scoreEl.innerText = score;
        flashMessage("Collected resource!");
      } else {
        flashMessage("No resource nearby");
      }
    }

    // Input
    window.addEventListener("keydown",e=>{ keys[e.code]=true; if(e.code==="KeyE") gather(); });
    window.addEventListener("keyup",e=>keys[e.code]=false);

    function move(delta) {
      const speed=5;
      const dir=new THREE.Vector3();
      if(keys["KeyW"]) dir.z -= 1;
      if(keys["KeyS"]) dir.z += 1;
      if(keys["KeyA"]) dir.x -= 1;
      if(keys["KeyD"]) dir.x += 1;
      if(dir.lengthSq()>0) {
        dir.normalize();
        playerGroup.position.addScaledVector(dir,speed*delta);
      }
    }

    function drawMinimap() {
      ctx.fillStyle="black"; ctx.fillRect(0,0,minimap.width,minimap.height);
      const cx=minimap.width/2, cy=minimap.height/2;
      ctx.fillStyle="red"; ctx.beginPath(); ctx.arc(cx,cy,4,0,Math.PI*2); ctx.fill();
      ctx.fillStyle="blue";
      for(let r of resources) {
        const dx=r.position.x-playerGroup.position.x;
        const dz=r.position.z-playerGroup.position.z;
        const scale=4;
        const x=cx+dx/scale, y=cy+dz/scale;
        if(x>=0 && x<=minimap.width && y>=0 && y<=minimap.height)
          ctx.fillRect(x-2,y-2,4,4);
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      const delta=clock.getDelta();
      move(delta);
      renderer.render(scene,camera);
      drawMinimap();
    }

    document.getElementById("startButton").addEventListener("click",()=>{
      document.getElementById("startScreen").style.display="none";
      init();
      animate();
    });
  </script>
</body>
</html>
