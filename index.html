<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rialo Explorer</title>
  <style>
    body { margin: 0; overflow: hidden; background: #111; }
    #scoreboard {
      position: fixed; top: 10px; left: 10px;
      color: white; font-size: 18px; font-family: Arial, sans-serif;
      background: rgba(0,0,0,0.5); padding: 8px 12px; border-radius: 6px;
      z-index: 10;
    }
    #message {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      color: yellow; font-size: 16px;
      background: rgba(0,0,0,0.6); padding: 6px 12px; border-radius: 6px;
      display: none; z-index: 10;
    }
    #controls { position: fixed; bottom: 30px; left: 20px; display: none; gap: 15px; z-index: 20; }
    #actions { position: fixed; bottom: 30px; right: 20px; display: none; flex-direction: column; gap: 15px; z-index: 20; }
    .btn {
      width: 60px; height: 60px; border-radius: 50%;
      background: rgba(255,255,255,0.2); border: 2px solid white;
      color: white; font-size: 28px; display: flex; justify-content: center; align-items: center;
      user-select: none; touch-action: none; cursor: pointer;
    }
    .btn:active { background: rgba(255,255,255,0.5); }
    #startScreen {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.9); display:flex; flex-direction:column; justify-content:center; align-items:center;
      z-index:100; color:white; font-family: Arial, sans-serif;
    }
    #startButton {
      margin-top: 20px; padding: 12px 24px; font-size: 20px; border:2px solid white;
      background: transparent; color: white; border-radius: 8px; cursor: pointer;
    }
    #startButton:hover { background: rgba(255,255,255,0.2); }
  </style>
</head>
<body>
  <div id="scoreboard">Rialo Points: 0</div>
  <div id="message"></div>

  <div id="controls">
    <div class="btn" data-key="KeyA">⬅️</div>
    <div class="btn" data-key="KeyW">⬆️</div>
    <div class="btn" data-key="KeyS">⬇️</div>
    <div class="btn" data-key="KeyD">➡️</div>
  </div>

  <div id="actions">
    <div class="btn" id="btnE">E</div>
  </div>

  <div id="startScreen">
    <h1>Rialo Explorer</h1>
    <p>Collect resources (E) and earn Rialo Points.</p>
    <button id="startButton">Start Game</button>
  </div>

  <!-- ✅ three.js + OrbitControls -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/geometries/TextGeometry.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/libs/dat.gui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/loaders/FontLoader.js"></script>

  <script>
    let scene, camera, renderer, controls;
    let sloth, resources = [];
    let score = 0;
    const scoreboard = document.getElementById("scoreboard");
    const message = document.getElementById("message");
    const startScreen = document.getElementById("startScreen");
    const keys = {};

    function createSloth() {
      const slothGroup = new THREE.Group();

      // Тіло
      const body = new THREE.Mesh(
        new THREE.CylinderGeometry(0.8, 0.8, 2.5, 16),
        new THREE.MeshPhongMaterial({ color: 0x8b5e3c })
      );
      slothGroup.add(body);

      // Голова
      const head = new THREE.Mesh(
        new THREE.SphereGeometry(0.7, 16, 16),
        new THREE.MeshPhongMaterial({ color: 0xa67c52 })
      );
      head.position.y = 1.7;
      slothGroup.add(head);

      // Очі
      const eyeGeo = new THREE.SphereGeometry(0.1, 8, 8);
      const eyeMat = new THREE.MeshPhongMaterial({ color: 0x000000 });
      const eye1 = new THREE.Mesh(eyeGeo, eyeMat);
      const eye2 = new THREE.Mesh(eyeGeo, eyeMat);
      eye1.position.set(-0.25, 1.8, 0.6);
      eye2.position.set(0.25, 1.8, 0.6);
      slothGroup.add(eye1, eye2);

      // Лапи
      const pawGeo = new THREE.BoxGeometry(0.3, 1, 0.3);
      const pawMat = new THREE.MeshPhongMaterial({ color: 0x8b5e3c });
      const paw1 = new THREE.Mesh(pawGeo, pawMat);
      const paw2 = new THREE.Mesh(pawGeo, pawMat);
      paw1.position.set(-0.5, -1, 0);
      paw2.position.set(0.5, -1, 0);
      slothGroup.add(paw1, paw2);

      slothGroup.position.set(0, 1.5, 0);
      return slothGroup;
    }

    function createBanner() {
      const loader = new THREE.FontLoader();
      loader.load("https://cdn.jsdelivr.net/npm/three@0.161.0/examples/fonts/helvetiker_regular.typeface.json", function (font) {
        const textGeo = new THREE.TextGeometry("RIALO", {
          font: font,
          size: 3,
          height: 0.5
        });
        const textMat = new THREE.MeshPhongMaterial({ color: 0xffff00 });
        const textMesh = new THREE.Mesh(textGeo, textMat);
        textMesh.position.set(-8, 12, -20);
        scene.add(textMesh);
      });
    }

    function initGame() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x77ccff);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 5, 10);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.target.set(0, 2, 0);
      controls.enableDamping = true;

      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(10, 20, 10);
      scene.add(light);
      scene.add(new THREE.AmbientLight(0x404040));

      const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(200, 200),
        new THREE.MeshPhongMaterial({ color: 0x228833 })
      );
      ground.rotation.x = -Math.PI / 2;
      scene.add(ground);

      sloth = createSloth();
      scene.add(sloth);

      createBanner();

      for (let i = 0; i < 10; i++) spawnTree();
      for (let i = 0; i < 6; i++) spawnRock();
      for (let i = 0; i < 4; i++) spawnGold();

      window.addEventListener('resize', onWindowResize);
      animate();
    }

    function spawnTree() {
      const trunk = new THREE.Mesh(
        new THREE.CylinderGeometry(0.3, 0.5, 2),
        new THREE.MeshPhongMaterial({ color: 0x8b4513 })
      );
      const leaves = new THREE.Mesh(
        new THREE.SphereGeometry(1.2, 8, 8),
        new THREE.MeshPhongMaterial({ color: 0x228b22 })
      );
      const tree = new THREE.Group();
      trunk.position.y = 1;
      leaves.position.y = 2.5;
      tree.add(trunk, leaves);
      tree.position.set((Math.random() - 0.5) * 100, 0, (Math.random() - 0.5) * 100);
      scene.add(tree);
      resources.push({ mesh: tree, type: "tree", points: 5 });
    }

    function spawnRock() {
      const rock = new THREE.Mesh(
        new THREE.IcosahedronGeometry(1, 0),
        new THREE.MeshPhongMaterial({ color: 0x808080 })
      );
      rock.position.set((Math.random() - 0.5) * 100, 1, (Math.random() - 0.5) * 100);
      scene.add(rock);
      resources.push({ mesh: rock, type: "rock", points: 8 });
    }

    function spawnGold() {
      const gold = new THREE.Mesh(
        new THREE.SphereGeometry(0.8, 12, 12),
        new THREE.MeshPhongMaterial({ color: 0xffd700 })
      );
      gold.position.set((Math.random() - 0.5) * 100, 1, (Math.random() - 0.5) * 100);
      scene.add(gold);
      resources.push({ mesh: gold, type: "gold", points: 15 });
    }

    function flashMessage(text) {
      message.innerText = text;
      message.style.display = "block";
      clearTimeout(message._hideTimeout);
      message._hideTimeout = setTimeout(() => message.style.display = "none", 1400);
    }

    function gatherResource() {
      let closest = null, dist = 3;
      for (let r of resources) {
        const d = sloth.position.distanceTo(r.mesh.position);
        if (d < dist) { dist = d; closest = r; }
      }
      if (closest) {
        scene.remove(closest.mesh);
        resources.splice(resources.indexOf(closest), 1);
        score += closest.points;
        scoreboard.innerText = "Rialo Points: " + score;
        flashMessage("Collected " + closest.type + "!");
      } else {
        flashMessage("No resource nearby");
      }
    }

    window.addEventListener("keydown", e => { keys[e.code] = true; if (e.code === "KeyE") gatherResource(); });
    window.addEventListener("keyup", e => { keys[e.code] = false; });

    document.querySelectorAll("#controls .btn").forEach(btn => {
      const key = btn.dataset.key;
      btn.addEventListener("pointerdown", ev => { ev.preventDefault(); keys[key] = true; });
      btn.addEventListener("pointerup", () => keys[key] = false);
      btn.addEventListener("pointerleave", () => keys[key] = false);
    });
    document.getElementById("btnE").addEventListener("pointerdown", ev => { ev.preventDefault(); gatherResource(); });

    function moveSloth(delta) {
      const speed = 5;
      if (keys["KeyW"]) sloth.position.z -= speed * delta;
      if (keys["KeyS"]) sloth.position.z += speed * delta;
      if (keys["KeyA"]) sloth.position.x -= speed * delta;
      if (keys["KeyD"]) sloth.position.x += speed * delta;
      camera.position.set(sloth.position.x, sloth.position.y + 4, sloth.position.z + 8);
      controls.target.copy(sloth.position);
    }

    const clock = new THREE.Clock();
    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();
      moveSloth(delta);
      controls.update();
      renderer.render(scene, camera);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    document.getElementById("startButton").addEventListener("click", () => {
      startScreen.style.display = "none";
      initGame();
      if (/Mobi|Android/i.test(navigator.userAgent)) {
        document.getElementById("controls").style.display = "flex";
        document.getElementById("actions").style.display = "flex";
      }
    });
  </script>
</body>
</html>
